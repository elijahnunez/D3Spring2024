<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Sandbox</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
     
    
    </style>
</head>
<body>
    <svg width="1000" height="1000"></svg>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>

        var categoryHeading = "Participation";
        var margin = {top: 10, right: 150, bottom: 30, left: 10},
            width  = 1000 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom,
            boxSize = 20, // size of each box
            boxGap = 1, // space between each box
            howManyAcross = Math.floor(width / boxSize);
        
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);
        
        var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
        
        
        d3.csv('Spring Forward Particiaption - Dropout .csv').then(function(data){
            // Parse the date
            data.forEach(function(d) {
                d.Date = d3.timeParse("%m/%d/%Y")(d.Date);
            });

            // Sort data by date
            data.sort(function(a, b) { return d3.ascending(a.Date, b.Date); });
            
            // Get all of the unique values in the column for the scale
            var keys = d3.map(data, function(d){ return d[categoryHeading]; }).keys();
            
            // Set domain on category
            colors.domain([0, keys.length]);
            
            // Convert to a categorical scale
            var categoryScale = d3.scaleOrdinal(keys.map(function(d, i){ return colors(i); }));
            categoryScale.domain(keys); // Set the scale domain
            
            // Make the main chart
            var squares = g.selectAll(".square")
                .data(data)
                .enter()
                .append("rect")
                .attr("class", "square")
                .attr("x", function(d, i) { return boxSize * (i % howManyAcross); })
                .attr("y", function(d, i) { return Math.floor(i / howManyAcross) * boxSize; })
                .attr("width", boxSize - 3)
                .attr("height", boxSize - 3)
                .attr("fill", "#361AE5"); // Initial fill color
            
            // Transition to fill squares over time
            squares.transition()
                .delay(function(d, i) { return i * 100; }) // Delay based on index
                .duration(500)
                .attr("fill", function(d) { return categoryScale(d[categoryHeading]); })
                .style("fill", "light blue");
            
            // Legend
            var legend = svg.selectAll(".legend")
                .data(keys)
                .enter();
            
            legend.append("rect")
                .attr("x", margin.left + width + boxGap)
                .attr("y", function(d, i) { return (i * boxSize) + margin.top; })
                .attr("width", boxSize - 3)
                .attr("height", boxSize - 3)
                .attr("fill", function(d) { return categoryScale(d); });
            
            legend.append("text")
                .attr("x", margin.left + width + boxSize + (boxGap * 2))
                .attr("y", function(d, i) { return (i * boxSize) + margin.top; })
                .append("tspan")
                .attr("dx", 0)
                .attr("dy", boxSize / 2)
                .style("alignment-baseline", "middle")
                .style("font-size", 10)
                .style("font-family", "Helvetica, Arial, sans-serif")
                .text(function(d) { return d; });
        });

        // rainbow colors
        var colors = d3.scaleSequential(d3.interpolateHclLong("purple", "orange"));

    </script>
</body>
</html>